{"version":3,"sources":["constants.js","utils/network.js","utils/stringUtils.js","booking/beneficiary.js","booking/slot.js","utils/queryParams.js","webCallback/index.js","assests/questionMark.svg","assests/build4bharat.jpg","stateView/index.js","App.js","reportWebVitals.js","index.js"],"names":["SECRET_KEYS","PROCESS_STAGE","API_URLS","SLOT_FILTER","VACCINE_SECOND_DOSE_BUFFER_DAYS","DOSE_TYPE","ERROR_CODE","COWIN_ERROR_CODE","ID_TYPE","VACCINE_TYPE","INVALID_PHONE_REASONS_TEXT","DEFAULT_AUTO_CALLBACK_STATE","callBackDelayInSeconds","isTimerOn","makePostCall","path","body","stateCallback","token","a","isLoading","Promise","resolve","then","fetch","method","headers","JSON","stringify","response","status","json","data","error","catch","errorObj","code","errorCode","message","makeGetCall","getFirstName","name","lowerName","_","word","getEditDistance","firstString","secondString","lengthFirstString","lengthSecondString","costs","indexFirst","indexSecond","Math","min","getSlotDateString","today","Date","nextDay","setDate","getDate","dd","mm","getMonth","yyyy","getFullYear","filterBeneficiary","state","beneficiaryList","paramsName","paramsDisplayName","displayName","idType","id_type","id_number","maskedIdNumber","slice","matchedBeneficiaryRecord","beneficiary_reference_id","beneficiaryId","idMatchRecord","entry","entryIdType","photo_id_type","entryIdNumber","similarBeneficiaries","verifiedName","beneficiaryNamesLowerCase","verifiedNameLowerCase","bestMatchResults","stringSimilarity","bestMatch","bestMatchIndex","rating","getStringSimilarityBasedBeneficiary","verifiedNameMatchedBeneficiary","firstName","getBeneficiaryDetailsEntity","beneficiary","beneficiary_id","vaccine","vaccination_status","dose1_date","dose2_date","checkIfAppointmentExpired","appointmentId","slotDate","moment","utc","diff","checkIfEligibleForDose2","beneficiaryDetails","dose1Date","fetchBenficiaries","FETCH_BENEFICIARY","stage","registeredBeneficiaryList","isUserEligibleForDose2","doseToBook","appointments","latestAppointment","getTargetSlotTime","availableSession","date","getCurrentDateString","slots","getAvailableVaccineSlot","centerList","lastAttemptedSession","capacityForDose","availableSlots","center","sessions","availableSessions","session","centerAvailability","doseAvailability","min_age_limit","session_id","maxAvailabilitySession","targetSlot","push","slot_time","freeSlotsAboveThreshold","slot","getPrioritisedSlot","fetchSlots","district","dateString","FETCH_SLOTS","vaccineSlot","getUrlParamsFromObj","obj","qs","_path","_path2","_path3","triggerCallback","callbackDelay","callbackParams","getCallbackParams","appState","getAppState","requestBody","auth_key","phone","registeredPhone","alternatePhone","app_state","queryString","window","setTimeout","location","href","callback","getErrorParams","metaData","getMetaDataParams","baseState","dose_1_date","dose_2_date","err_code","err_message","meta_data","lastAppointment","center_id","center_name","dose","appointment_id","vaccineFee","getVaccineFee","center_address","address","center_district_name","district_name","center_pincode","pincode","vaccine_fee","vaccineFeeRates","selectedVaccineRate","available_beneficiaries","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgQuestionMark","_ref","svgRef","title","titleId","props","width","height","viewBox","fill","xmlns","ref","id","fillRule","clipRule","d","ForwardRef","getRedirectElement","classes","className","Typography","getAlternateNumberElement","enterAlternatePhoneInitStage","goToHome","Grid","container","justify","alignItems","direction","Button","button","variant","color","fullWidth","onClick","goHomeButton","renderOtpStage","params","retryTime","changeOtp","submitOtp","triggerOtp","retryEnabled","retryTimeString","toISOString","substr","item","lg","Box","fontWeight","my","Link","TextField","maxLength","type","label","value","otp","onChange","e","disabled","getBookingActionElement","bookingAttempt","getRetryElement","renderErrorStage","errorMessage","errCode","NO_BENEFICIARY","getErrorMessage","shajs","require","useStyles","makeStyles","root","backgroundColor","image","overflowY","card","flexGrow","minHeight","margin","padding","position","bottom","marginTop","borderRadius","getRandomSecretKey","index","parseInt","random","withRouter","searchParams","search","ignoreQueryPrefix","initialStage","useState","lastPhone","setState","setRetryTime","setBookingAttempt","autoCallBackState","setAutoCallBackState","updatedState","secretKey","INIT","txnId","otpHash","update","digest","VALIDATE_OTP","rescheduleSlot","RESCHEDULE","scheduleSlot","SCHEDULE","changeRegisteredPhone","submitRegisteredPhone","activePhone","confirmRegisteredPhone","handleBookingFailure","intervalId","clearInterval","useEffect","captcha","renderView","renderSuccessStage","renderVaccinatedStage","alternateNumberElement","renderExistingBookingStage","bookingActionElement","renderBookingFailedStage","renderRegisteredStage","renderNotRegiseteredState","size","renderAlternatePhoneInitState","SvgIcon","component","QuestionIcon","overflow","spacing","xs","renderPhoneNumberConfirmation","getRenderView","errorItem","src","Image","Card","CircularProgress","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","App","document","getElementById"],"mappings":"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","file":"static/js/main.62b4a16b.chunk.js","sourcesContent":["\nexport const SECRET_KEYS = [\n  'U2FsdGVkX1/fkazU2I2Rdz3hI7iWT6HRzThZj16rpyn4xYM6wcbd84k4CpJimxC0YpG3kFn9qog6LhmaRoS14g==',\n  'U2FsdGVkX19I0TpTI50qTW+0o+LEWSBPYIcivZR4gvANVyLhRhP+rwapNMmyE3tE7e2EeEIV8X6YVfOODlCUbg==',\n  'U2FsdGVkX181DnPRmCbp6NePNHeHRfh3dAO9dMMSApKdvNpIEcK11CYuqjyI04DU4TRuktcSduxWej8OGCz9ZA==',\n  'U2FsdGVkX19NYwIf1jzNr2ghhC7bH1/H36TLGsiUKSopzfhdHB4aSa2RczWmSdN35ZwZXJ18cha9qX1vLO1BpQ==',\n  'U2FsdGVkX18kqQVkl8zGUA8schCVAm6NWNM0q/bCV7dHyUJoy8JPbRms4IIsFNU4Ahx6ffx0FVYsOIatS98WjA==',\n  \"U2FsdGVkX18y9RiV+sdQG+dNc09ETZfLddhx6sEu10zP07S14C9X4cdXXRtwJ+Pa+x2zycwllBLV9opSgQ9Cjg==\"\n];\n\nexport const PROCESS_STAGE = {\n  INIT: 'INIT',\n  VALIDATE_OTP: 'VALIDATE_OTP',\n  FETCH_BENEFICIARY: 'FETCH_BENEFICIARY',\n  FETCH_SLOTS: 'FETCH_SLOTS',\n  SCHEDULE: 'SCHEDULE',\n  SLOT_BOOKED: 'SLOT_BOOKED',\n  ERROR: 'ERROR',\n  EXISTING_BOOKING: 'EXISTING_BOOKING',\n  BOOKING_FAILED: 'BOOKING_FAILED',\n  VACCINATED: 'VACCINATED',\n  REGISTERED: 'REGISTERED',\n  NOT_REGISTERED: 'NOT_REGISTERED',\n  ALTERNATE_PHONE_INIT: 'ALTERNATE_PHONE_INIT',\n  CONFIRM_PHONE: 'CONFIRM_PHONE'\n};\n\nexport const API_URLS = {\n  [PROCESS_STAGE.INIT]: 'https://cdn-api.co-vin.in/api/v2/auth/generateMobileOTP',\n  [PROCESS_STAGE.VALIDATE_OTP]: 'https://cdn-api.co-vin.in/api/v2/auth/validateMobileOtp',\n  [PROCESS_STAGE.FETCH_BENEFICIARY]: 'https://cdn-api.co-vin.in/api/v2/appointment/beneficiaries',\n  [PROCESS_STAGE.SCHEDULE]: 'https://cdn-api.co-vin.in/api/v2/appointment/schedule',\n  [PROCESS_STAGE.FETCH_SLOTS]: 'https://cdn-api.co-vin.in/api/v2/appointment/sessions/calendarByDistrict',\n  'RESCHEDULE': 'https://cdn-api.co-vin.in/api/v2/appointment/reschedule',\n};\n\nexport const ALLOWED_NAME_EDITS = 3;\n\nexport const SLOT_FILTER = {\n  MIN_AGE: 18,\n  MIN_CAPACITY: 5\n};\n\nexport const VACCINE_SECOND_DOSE_BUFFER_DAYS = {\n  'COVISHIELD': 84,\n  'COVAXIN': 28,\n  'SPUTNIK V': 21,\n};\n\nexport const DOSE_TYPE = {\n  FIRST: 1,\n  SECOND: 2,\n};\n\nexport const ERROR_CODE = {\n  NO_BENEFICIARY: 'NO_BENEFICIARY',\n  NO_SLOT: 'NO_SLOT',\n  INVALID_OTP: 'INVALID_OTP',\n  EXISTING_BOOKING: 'EXISTING_BOOKING',\n  BOOKING_FAILED: 'BOOKING_FAILED',\n  UNKNOWN_ERROR: 'UNKNOWN_ERROR',\n  INVALID_PHONE: 'INVALID_PHONE'\n};\n\nexport const COWIN_ERROR_CODE = {\n  [ERROR_CODE.EXISTING_BOOKING]: 'APPOIN0022',\n  [ERROR_CODE.INVALID_OTP]: 'USRAUT0014',\n  [ERROR_CODE.NO_BENEFICIARY]: 'APPOIN0001'\n};\n\nexport const OTP_RETRY_TIME = 120;\n\nexport const MAX_BOOKING_ATTEMPT = 2;\n\nexport const ID_TYPE = {\n  'Aadhaar Card': 'aadhaar_card',\n  'PAN Card': 'pan_card'\n};\n\nexport const VACCINE_TYPE = {\n  FREE: 'Free',\n  PAID: 'Paid'\n}\n\nexport const FREE_SLOT_THRESHOLD = 30;\n\nexport const SLOT_CUTOFF_HOUR = 15;\n\nexport const INVALID_PHONE_REASONS_TEXT = {\n  SAME_AS_LAST: 'New phone number can\\'t be same as last',\n  DEFAULT: 'Please enter a valid phone number'\n};\n\nexport const DEFAULT_AUTO_CALLBACK_STATE = {\n  callBackDelayInSeconds: 15,\n  isTimerOn: false\n};\n\nexport const MAX_BENEFICIARY_ALLOWED = 5;\n","export const makePostCall = async (path, body, stateCallback, token) => {\n  stateCallback({ isLoading: true });\n  return Promise.resolve()\n  .then(() => {\n    return fetch(path, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}` },\n      body: JSON.stringify(body)\n    })\n  })\n  .then((response) => {\n    if(response.status === 204) return {};\n    return response.json();\n  })\n  .then((data) => {\n    stateCallback({ isLoading: false });\n    if (data.error) {\n      throw data;\n    }\n    return data;\n  })\n  .catch(data => {\n    stateCallback({ errorObj: {code: data.errorCode, message: data.error }, isLoading: false });\n    throw data;\n  });\n};\n\nexport const makeGetCall = async (path, stateCallback, token) => {\n  stateCallback({ isLoading: true });\n  return Promise.resolve()\n  .then(() => {\n    return fetch(path, {\n      method: 'GET',\n      headers: { 'Content-Type': 'application/json',\n      'Authorization': `Bearer ${token}` }\n    })\n  })\n  .then((response) => {\n    return response.json();\n  })\n  .then((data) => {\n    stateCallback({ isLoading: false });\n    if (data.error) {\n      throw data;\n    }\n    return data;\n  })\n  .catch(data => {\n    stateCallback({ errorObj: {code: data.errorCode, message: data.error }, isLoading: false });\n    throw data;\n  });\n};\n","import * as _ from 'lodash';\nimport * as stringSimilarity from 'string-similarity';\nconst MAX_STRING_CHECK = 50;\nconst MIN_STRING_SIMILARITY = 0.7;\n\nexport const getFirstName = (name) => {\n  const lowerName = _.toLower(name);\n  return _.find(_.split(lowerName, /\\s|\\.|\\,/), (word) => {\n    return _.size(word) > 2;\n  });\n};\n\n// Levenshtein distance\nexport const getEditDistance = (firstString, secondString) => {\n  const lengthFirstString = _.size(firstString);\n  const lengthSecondString = _.size(secondString);\n  if (lengthSecondString > MAX_STRING_CHECK ||  lengthFirstString > MAX_STRING_CHECK) {\n    return MAX_STRING_CHECK;\n  }\n\n  const costs = [];\n  _.forEach(_.range(0, lengthFirstString+1), (indexFirst) => {\n    costs[indexFirst] = [indexFirst];\n  });\n  _.forEach(_.range(0, lengthSecondString+1), (indexSecond) => {\n    costs[0][indexSecond] = indexSecond;\n  });\n\n  _.forEach(_.range(1, lengthFirstString+1), (indexFirst) => {\n    _.forEach(_.range(1, lengthSecondString+1), (indexSecond) => {\n     if (firstString[indexFirst - 1] === secondString[indexSecond - 1]){\n        costs[indexFirst][indexSecond] = costs[indexFirst-1][indexSecond-1];\n      } else {\n        costs[indexFirst][indexSecond] =  Math.min(costs[indexFirst-1][indexSecond-1] + 1,\n          Math.min(costs[indexFirst][indexSecond-1] + 1,\n            costs[indexFirst-1][indexSecond] + 1))\n      }\n    })\n  });\n\n  return costs[lengthFirstString][lengthSecondString];\n};\n\nexport const getCurrentDateString = () => {\n  const today = new Date();\n  const dd = today.getDate();\n  const mm = today.getMonth() + 1;\n  const yyyy = today.getFullYear();\n\n  return `${(dd>9 ? '' : '0') + dd}-${(mm>9 ? '' : '0') + mm}-${yyyy}`;\n};\n\nexport const getSlotDateString = () => {\n  const today = new Date();\n  const nextDay = new Date(today);\n  nextDay.setDate(today.getDate() + 1);\n  const dd = nextDay.getDate();\n  const mm = nextDay.getMonth() + 1;\n  const yyyy = nextDay.getFullYear();\n\n  return `${dd}-${(mm>9 ? '' : '0') + mm}-${yyyy}`;\n};\n\nexport const getMinuteString = (seconds) => {\n  return new Date(seconds * 1000).toISOString().substr(14, 5);\n};\n\nexport const getStringSimilarityBasedBeneficiary = (beneficiaryList, verifiedName) => {\n  if (_.isEmpty(beneficiaryList)) {\n    return undefined;\n  }\n  const beneficiaryNamesLowerCase = _.map(beneficiaryList, ({ name }) => {\n    return _.toLower(name);\n  });\n  const verifiedNameLowerCase = _.toLower(verifiedName);\n  const bestMatchResults = stringSimilarity.findBestMatch(verifiedNameLowerCase, beneficiaryNamesLowerCase);\n  const { bestMatch={}, bestMatchIndex } = bestMatchResults;\n  const { rating=0 } = bestMatch;\n  if (rating > MIN_STRING_SIMILARITY) {\n    return beneficiaryList[bestMatchIndex];\n  }\n  return undefined;\n}","import * as _ from 'lodash';\nimport moment from 'moment';\nimport { makeGetCall, makePostCall } from '../utils/network';\nimport { getEditDistance, getFirstName, getCurrentDateString,\n  getStringSimilarityBasedBeneficiary } from '../utils/stringUtils';\nimport {\n  PROCESS_STAGE,\n  API_URLS,\n  ALLOWED_NAME_EDITS,\n  ID_TYPE,\n  VACCINE_SECOND_DOSE_BUFFER_DAYS,\n  DOSE_TYPE,\n} from '../constants';\n\nconst filterBeneficiary = (state, beneficiaryList) => {\n  const paramsName = getFirstName(state.name);\n  const paramsDisplayName = getFirstName(state.displayName);\n  const { id_type: idType, id_number: idNumber='' } = state;\n  const maskedIdNumber = idNumber.slice(-4);\n\n  const matchedBeneficiaryRecord = _.find(beneficiaryList, { beneficiary_reference_id: state.beneficiaryId });\n  if (!_.isEmpty(matchedBeneficiaryRecord)) {\n    return matchedBeneficiaryRecord;\n  }\n\n  const idMatchRecord = _.find(beneficiaryList, (entry) => {\n    const entryIdType = ID_TYPE[entry.photo_id_type];\n    const entryIdNumber = _.get(entry, 'photo_id_number', '').slice(-4);\n\n    return idType === entryIdType && maskedIdNumber === entryIdNumber;\n  });\n  if (!_.isEmpty(idMatchRecord)) {\n    return idMatchRecord;\n  }\n\n  const similarBeneficiaries = getStringSimilarityBasedBeneficiary(beneficiaryList, state.name);\n  if(!_.isEmpty(similarBeneficiaries)) {\n    return similarBeneficiaries;\n  }\n\n  const verifiedNameMatchedBeneficiary = _.find(beneficiaryList, (entry) => {\n    const { name } = entry;\n    const firstName = getFirstName(name);\n    const editDistance = getEditDistance(paramsName, firstName);\n    return editDistance < ALLOWED_NAME_EDITS;\n  });\n  if (!_.isEmpty(verifiedNameMatchedBeneficiary)) {\n    return verifiedNameMatchedBeneficiary;\n  }\n\n  const profileNameMatchedBeneficiary = _.find(beneficiaryList, ({ name }) => {\n    const firstName = getFirstName(name);\n    const editDistanceScore = getEditDistance(paramsDisplayName, firstName);\n    return editDistanceScore < ALLOWED_NAME_EDITS;\n  });\n\n  return profileNameMatchedBeneficiary;\n};\n\nconst getBeneficiaryDetailsEntity = (beneficiaryList) => {\n  return _.map(beneficiaryList, (beneficiary) => {\n    return {\n      beneficiary_id: beneficiary.beneficiary_reference_id,\n      name: beneficiary.name,\n      vaccine: beneficiary.vaccine,\n      vaccination_status: beneficiary.vaccination_status,\n      dose1_date: beneficiary.dose1_date,\n      dose2_date: beneficiary.dose2_date,\n      };\n  });\n};\n\nconst checkIfAppointmentExpired = (appointmentId, slotDate) => {\n  return !_.isEmpty(appointmentId)\n  && !_.isEmpty(slotDate)\n  && moment.utc().diff(moment.utc(slotDate, 'DD-MM-YYYY'), 'days') >= 2;\n};\n\nconst checkIfEligibleForDose2 = beneficiaryDetails => {\n  const dose1Date = _.get(beneficiaryDetails, \"dose1_date\", \"\");\n  const vaccine = _.get(beneficiaryDetails, \"vaccine\", \"\");\n  return (\n    !_.isEmpty(dose1Date) &&\n    moment.utc().diff(moment.utc(dose1Date, \"DD-MM-YYYY\"), \"days\") >=\n      VACCINE_SECOND_DOSE_BUFFER_DAYS[vaccine]\n  );\n};\n\nexport const fetchBenficiaries = async (state, stateCallback) => {\n  try {\n    const data = await makeGetCall(API_URLS.FETCH_BENEFICIARY, stateCallback, state.token);\n    const beneficiaryList = _.get(data, 'beneficiaries', []);\n    const beneficiaryDetails = filterBeneficiary(state, beneficiaryList);\n    if (_.isEmpty(beneficiaryDetails)) {\n      stateCallback({\n        stage: PROCESS_STAGE.NOT_REGISTERED,\n        registeredBeneficiaryList: getBeneficiaryDetailsEntity(beneficiaryList)\n      });\n      return;\n    }\n    // Go to vaccinated stage -\n    // 1. If Dose 2 date is present.\n    // 2. If Dose 2 date is not present, but beneficiary is still not eligible for dose 2.\n    if(!_.isEmpty(beneficiaryDetails.dose2_date)) {\n      stateCallback({ stage: PROCESS_STAGE.VACCINATED, beneficiaryDetails });\n      return;\n    }\n    const isUserEligibleForDose2 = checkIfEligibleForDose2(beneficiaryDetails);\n    const doseToBook = isUserEligibleForDose2 ? DOSE_TYPE.SECOND: DOSE_TYPE.FIRST;\n    if (!isUserEligibleForDose2 && !_.isEmpty(beneficiaryDetails.dose1_date)) {\n      stateCallback({ stage: PROCESS_STAGE.VACCINATED, beneficiaryDetails });\n      return;\n    }\n    if (!_.isEmpty(beneficiaryDetails.appointments)) {\n      // Check if a reschedule is needed - if appointment is more than a day old.\n      const latestAppointment = _.maxBy(beneficiaryDetails.appointments, 'date');\n      const appointmentId = _.get(latestAppointment, 'appointment_id', '');\n      const slotDate = _.get(latestAppointment, 'date', '');\n\n      if(checkIfAppointmentExpired(appointmentId, slotDate)) {\n        stateCallback({stage: PROCESS_STAGE.FETCH_SLOTS, beneficiaryDetails, appointmentId, doseToBook});\n        return;\n      }\n      stateCallback({stage: PROCESS_STAGE.EXISTING_BOOKING, beneficiaryDetails });\n      return;\n    }\n    stateCallback({stage: PROCESS_STAGE.FETCH_SLOTS, beneficiaryDetails, doseToBook });\n  } catch(err) {\n\n  }\n};\n","import * as _ from 'lodash';\nimport { makeGetCall } from '../utils/network';\nimport { getCurrentDateString, getSlotDateString } from '../utils/stringUtils';\nimport {\n  PROCESS_STAGE,\n  API_URLS,\n  SLOT_FILTER,\n  ERROR_CODE,\n  FREE_SLOT_THRESHOLD,\n  VACCINE_TYPE,\n  DOSE_TYPE,\n} from \"../constants\";\n\nconst getTargetSlotTime = (availableSession) => {\n  const slotDate = availableSession.date;\n  const currentDateString = getCurrentDateString();\n\n  if (currentDateString !== slotDate) {\n    return availableSession.slots[0];\n  }\n  return _.last(availableSession.slots);\n};\n\nconst getPrioritisedSlot = (availableSlots, capacityForDose) => {\n  const freeSlotsAboveThreshold = _.filter(availableSlots, (slots) => {\n    return _.get(slots, 'fee_type') == VACCINE_TYPE.FREE\n      && _.get(slots, [capacityForDose]) >= FREE_SLOT_THRESHOLD;\n  });\n  if(!_.isEmpty(freeSlotsAboveThreshold)) {\n    return _.maxBy(freeSlotsAboveThreshold, slot => slot[capacityForDose]);\n  }\n  return _.maxBy(availableSlots, slot => slot[capacityForDose]);\n};\n\nconst getAvailableVaccineSlot = (state, centerList, doseToBook) => {\n  const lastAttemptedSession = _.get(state, 'vaccineSlot.session_id');\n  const capacityForDose = doseToBook === DOSE_TYPE.SECOND ? 'available_capacity_dose2': 'available_capacity_dose1';\n  const availableSlots = [];\n  _.forEach(centerList, (center) => {\n    const { sessions } = center;\n    const availableSessions = _.filter(sessions, (session) => {\n      const centerAvailability = _.get(session, 'available_capacity', 0);\n      const doseAvailability = _.get(session, [capacityForDose], 0);\n      return centerAvailability > 0 && doseAvailability >= SLOT_FILTER.MIN_CAPACITY &&\n        session.min_age_limit === SLOT_FILTER.MIN_AGE && session.session_id !== lastAttemptedSession;\n    });\n\n    const maxAvailabilitySession = _.maxBy(availableSessions, session => session[capacityForDose]);\n\n    if (maxAvailabilitySession) {\n      const targetSlot = getTargetSlotTime(maxAvailabilitySession);\n      availableSlots.push({\n        ...center,\n        ...maxAvailabilitySession,\n        slot_time: targetSlot\n      });\n    }\n  });\n\n  return getPrioritisedSlot(availableSlots, capacityForDose);\n};\n\nexport const fetchSlots = async(state, stateCallback) => {\n  const { district, doseToBook } = state;\n  if (!district) {\n    stateCallback({ stage: PROCESS_STAGE.REGISTERED });\n    return;\n  }\n  const dateString = getSlotDateString();\n  try {\n    const data = await makeGetCall(`${API_URLS.FETCH_SLOTS}?district_id=${district}&date=${dateString}`,\n     stateCallback, state.token);\n    const centerList = _.get(data, 'centers', []);\n    const vaccineSlot = getAvailableVaccineSlot(state, centerList, doseToBook);\n    if (_.isEmpty(vaccineSlot)) {\n      stateCallback({errorObj: { code: ERROR_CODE.NO_SLOT, message: `No available slot found for district ${district}`} })\n      return;\n    }\n    stateCallback({ stage: PROCESS_STAGE.SCHEDULE, vaccineSlot })\n  } catch(err) {\n\n  }\n};\n","import * as qs from 'qs';\n\nexport function getSearchParamsFromUrl(queryString) {\n  const searchParams = qs.parse(queryString, { ignoreQueryPrefix: true });\n  return searchParams || {};\n}\n\nexport function getUrlParamsFromObj(obj) {\n  const urlParams = qs.stringify(obj);\n  return urlParams;\n}","import { getUrlParamsFromObj } from '../utils/queryParams';\nimport { ERROR_CODE, PROCESS_STAGE, MAX_BENEFICIARY_ALLOWED } from '../constants';\nimport * as _ from 'lodash';\n\nexport const triggerCallback = (state, callbackDelay=3000) => {\n  const callbackParams = getCallbackParams(state);\n  const appState = getAppState(state.stage);\n  const requestBody = {\n    ...callbackParams,\n    auth_key: state.auth_key,\n    phone: state.phone || state.registeredPhone,\n    alternatePhone: state.registeredPhone,\n    app_state: appState\n  }\n  const queryString = getUrlParamsFromObj(requestBody);\n  window.setTimeout(function() {\n    window.location.href = `${state.callback}?${queryString}`;\n  }, callbackDelay);\n};\n\nconst getCallbackParams = (state) => {\n  const { beneficiaryDetails={} } = state;\n  const errorObj = getErrorParams(state);\n  const metaData = getMetaDataParams(state);\n  const baseState = {\n    beneficiary_id: beneficiaryDetails.beneficiary_reference_id,\n    name: beneficiaryDetails.name,\n    vaccine: beneficiaryDetails.vaccine,\n    vaccination_status: beneficiaryDetails.vaccination_status,\n    dose_1_date: beneficiaryDetails.dose1_date,\n    dose_2_date: beneficiaryDetails.dose2_date,\n    err_code: errorObj.code,\n    err_message: errorObj.message,\n    meta_data: JSON.stringify(metaData)\n  };\n\n  switch(state.stage) {\n    case PROCESS_STAGE.EXISTING_BOOKING:\n      const { appointments=[] } = beneficiaryDetails;\n      const lastAppointment = _.last(appointments) || {};\n      return {\n        ...baseState,\n        center_id: lastAppointment.center_id,\n        center_name: lastAppointment.name,\n        slot: lastAppointment.slot,\n        session_id: lastAppointment.session_id,\n        date: lastAppointment.date,\n        dose: lastAppointment.dose,\n        appointment_id: lastAppointment.appointment_id\n      };\n    case PROCESS_STAGE.SLOT_BOOKED:\n      const { vaccineSlot={}, appointmentId } = state;\n      const vaccineFee = getVaccineFee(vaccineSlot);\n      return {\n        ...baseState,\n        appointment_id: appointmentId,\n        center_id: vaccineSlot.center_id,\n        center_name: vaccineSlot.name,\n        center_address: vaccineSlot.address,\n        center_district_name: vaccineSlot.district_name,\n        center_pincode: vaccineSlot.pincode,\n        slot: vaccineSlot.slot_time,\n        session_id: vaccineSlot.session_id,\n        date: vaccineSlot.date,\n        vaccine_fee: vaccineFee,\n        vaccine: vaccineSlot.vaccine,\n        dose: state.doseToBook,\n      };\n    default:\n      return baseState;\n  }\n};\n\nconst getErrorParams = (state) => {\n  if (state.stage === PROCESS_STAGE.SLOT_BOOKED) {\n    return {};\n  }\n\n  if (state.stage === PROCESS_STAGE.NOT_REGISTERED) {\n    return !_.isEmpty(state.errorObj) ? state.errorObj : {\n      code: ERROR_CODE.NO_BENEFICIARY,\n      message: _.join(_.map(state.registeredBeneficiaryList, 'name'), ',')\n    };\n  }\n  return state.errorObj || {};\n};\n\nconst getAppState = (stage) => {\n  if (stage === PROCESS_STAGE.NOT_REGISTERED) {\n    return PROCESS_STAGE.ERROR;\n  }\n\n  return stage\n};\n\nconst getVaccineFee = (vaccineSlot = {}) => {\n  const vaccineFeeRates = _.get(vaccineSlot, 'vaccine_fees', []);\n  const selectedVaccineRate = _.find(vaccineFeeRates, (entry = {}) => {\n    return entry.vaccine === vaccineSlot.vaccine;\n  });\n  return _.get(selectedVaccineRate, 'fee', '0');\n};\n\nconst getMetaDataParams = (state) => {\n  if (state.stage === PROCESS_STAGE.NOT_REGISTERED) {\n    return { available_beneficiaries: _.slice(state.registeredBeneficiaryList, 0, MAX_BENEFICIARY_ALLOWED) };\n  }\n  return {};\n}\n","var _path, _path2, _path3;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgQuestionMark(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, [\"title\", \"titleId\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 42,\n    height: 42,\n    viewBox: \"0 0 42 42\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M21 4C11.6177 4 4 11.6177 4 21C4 30.384 11.6177 38 21 38C30.3823 38 38 30.384 38 21C38 11.6177 30.3823 4 21 4Z\",\n    fill: \"#EFFAFC\"\n  })), _path2 || (_path2 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M22.75 29.3333C22.75 28.4133 21.966 27.6667 21 27.6667C20.034 27.6667 19.25 28.4133 19.25 29.3333C19.25 30.2533 20.034 31 21 31C21.966 31 22.75 30.2533 22.75 29.3333Z\",\n    fill: \"#0992AE\"\n  })), _path3 || (_path3 = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M21 21C20.034 21 19.25 21.7467 19.25 22.6667V24.3333C19.25 25.2533 20.034 26 21 26C21.966 26 22.75 25.2533 22.75 24.3333V24.1233C25.767 23.3833 28 20.7717 28 17.6667C28 13.9883 24.864 11 21 11C17.136 11 14 13.9883 14 17.6667C14 18.5867 14.784 19.3333 15.75 19.3333C16.716 19.3333 17.5 18.5867 17.5 17.6667C17.5 15.8283 19.068 14.3333 21 14.3333C22.932 14.3333 24.5 15.8283 24.5 17.6667C24.5 19.5067 22.932 21 21 21Z\",\n    fill: \"#0992AE\"\n  })));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgQuestionMark);\nexport default __webpack_public_path__ + \"static/media/questionMark.ca6214fd.svg\";\nexport { ForwardRef as ReactComponent };","export default __webpack_public_path__ + \"static/media/build4bharat.06144520.jpg\";","import React from 'react';\nimport * as _ from 'lodash';\nimport { OTP_RETRY_TIME, MAX_BOOKING_ATTEMPT, ERROR_CODE, COWIN_ERROR_CODE, PROCESS_STAGE } from '../constants';\nimport {ReactComponent as QuestionIcon} from \"../assests/questionMark.svg\";\nimport TextField from '@material-ui/core/TextField';\nimport Button from '@material-ui/core/Button';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport Link from '@material-ui/core/Link';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { getMinuteString } from '../utils/stringUtils';\nimport Box from '@material-ui/core/Box';\nimport SvgIcon from \"@material-ui/core/SvgIcon\";\n\nconst getRedirectElement = (classes) => {\n  return (<div className={classes.body}>\n    <Typography>\n     Taking you back...\n    </Typography>\n  </div>)\n};\n\nconst getRetryElement = (classes) => {\n  return (<div className={classes.body}>\n    <Typography>\n     Retrying some other slot...\n    </Typography>\n  </div>)\n};\n\nconst getAlternateNumberElement = (classes, enterAlternatePhoneInitStage, goToHome) => {\n  return (<div>\n    <Grid container justify=\"center\" alignItems=\"center\" direction=\"column\">\n      <Button className={classes.button}\n        variant=\"contained\"\n        color=\"primary\"\n        fullWidth={true}\n        onClick={enterAlternatePhoneInitStage}>\n          <Typography variant=\"subtitle2\">\n            Vaccinated on different number?\n          </Typography>\n      </Button>\n      <Button className={classes.goHomeButton}\n        variant=\"outlined\"\n        color=\"primary\"\n        fullWidth={true}\n        onClick={goToHome}>\n          <Typography variant=\"subtitle2\">\n            Go to home\n          </Typography>\n      </Button>\n    </Grid>\n  </div>);\n};\n\nexport const renderOtpStage = (params) => {\n  const { state, retryTime, classes, changeOtp, submitOtp, triggerOtp, enterAlternatePhoneInitStage } = params;\n  const retryEnabled = (retryTime < 1);\n  const retryTimeString = getMinuteString(retryTime);\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\">\n            LOGIN\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          Enter OTP\n        </Box>\n        </Typography>\n        <Typography variant='subtitle2'>\n          <Box my={2}>\n            <Box>\n              OTP sent to {state.registeredPhone}\n            </Box>\n            <Link onClick={enterAlternatePhoneInitStage}>\n              Vaccine registered on different number?\n            </Link>\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <TextField maxLength={6} type=\"number\" id=\"otp\" label=\"6-digit OTP\" variant=\"outlined\" value={state.otp} onChange={e => changeOtp(e.target.value)} />\n      </Grid>\n      <Grid container justify=\"space-between\">\n        <Grid item lg={6}>\n        <Button className={classes.button} id=\"otp\" variant=\"contained\" color=\"primary\" onClick={submitOtp}\n          disabled={state.isLoading}>\n          Submit OTP\n        </Button>\n        </Grid>\n        <Grid item lg={6}>\n        <Button className={classes.button} id=\"otp\" variant=\"contained\"\n          color={retryEnabled?\"primary\":\"default\"}\n          onClick={triggerOtp}\n          disabled={!retryEnabled || state.isLoading}>\n          {`Retry ${retryEnabled?'':'('+retryTimeString+')'}`}\n        </Button>\n        </Grid>\n      </Grid>\n    </Grid>\n  )\n};\n\nexport const renderSuccessStage = (classes) => {\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\" color=\"success.main\">\n            SLOT BOOKED\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          Your vaccinated slot has been booked\n        </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        {getRedirectElement(classes)}\n      </Grid>\n    </Grid>\n  )\n};\n\nexport const renderVaccinatedStage = (classes) => {\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\" color=\"success.main\">\n            VACCINATED\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          You have been vaccinated\n        </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        {getRedirectElement(classes)}\n      </Grid>\n    </Grid>\n  )\n};\n\nexport const renderExistingBookingStage = ({ classes, enterAlternatePhoneInitStage,\n  goToHome, autoCallBackState }) => {\n    const alternateNumberElement = getAlternateNumberElement(classes, enterAlternatePhoneInitStage, goToHome);\n    return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\" color=\"success.main\">\n            SLOT BOOKED\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          You have a slot booking\n        </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        {autoCallBackState.isTimerOn &&\n          <Typography>\n             Taking you back in {autoCallBackState.callBackDelayInSeconds}\n          </Typography>}\n      </Grid>\n      {alternateNumberElement}\n    </Grid>\n  )\n};\n\nconst getBookingActionElement = (bookingAttempt, classes) => {\n  if (bookingAttempt < MAX_BOOKING_ATTEMPT) {\n    return getRetryElement(classes);\n  }\n  return getRedirectElement(classes);\n}\n\nexport const renderBookingFailedStage = (state, bookingAttempt, classes) => {\n  const bookingActionElement = getBookingActionElement(bookingAttempt, classes);\n\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\" color=\"secondary.main\">\n            BOOKING FAILED\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          All slots booked before your booking\n        </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        {bookingActionElement}\n      </Grid>\n    </Grid>\n  )\n};\n\nconst getErrorMessage = (state) => {\n  const errCode = _.get(state.errorObj, 'code');\n  if (errCode === ERROR_CODE.NO_BENEFICIARY || errCode === COWIN_ERROR_CODE.NO_BENEFICIARY) {\n    return (<Typography variant=\"h6\">\n    <Box fontWeight=\"fontWeightBold\">\n      Your registration on CoWin Portal is pending.\n      Please register first so that you can book slots.\n    </Box>\n    </Typography>);\n  }\n  return (<Typography variant=\"body2\">\n    <Box fontWeight=\"fontWeightBold\" color=\"secondary.main\">\n      SOMETHING WENT WRONG\n    </Box>\n  </Typography>);\n};\n\nexport const renderErrorStage = (state, classes) => {\n  const errorMessage = getErrorMessage(state);\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        {errorMessage}\n      </Grid>\n      <Grid item lg={12}>\n        {getRedirectElement(classes)}\n      </Grid>\n    </Grid>\n  )\n};\n\nexport const renderRegisteredStage = ({ classes, enterAlternatePhoneInitStage,\n  goToHome, autoCallBackState }) => {\n  const alternateNumberElement = getAlternateNumberElement(classes, enterAlternatePhoneInitStage, goToHome);\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"body2\">\n          <Box fontWeight=\"fontWeightBold\" color=\"success.main\">\n            STATUS CONFIRMED\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n        <Box fontWeight=\"fontWeightBold\">\n          You have registered on CoWin portal. Please book a slot for vaccination soon.\n        </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        {autoCallBackState.isTimerOn &&\n          <Typography>\n             Taking you back in {autoCallBackState.callBackDelayInSeconds}\n          </Typography>}\n      </Grid>\n      {alternateNumberElement}\n    </Grid>\n  )\n};\n\nexport const renderNotRegiseteredState = (params) => {\n  const { classes, registeredPhone, enterAlternatePhoneInitStage, goToHome, autoCallBackState } = params;\n  const alternateNumberElement = getAlternateNumberElement(classes, enterAlternatePhoneInitStage, goToHome);\n  return (\n    <Grid alignItems=\"center\" justify=\"center\">\n      <Grid item lg={12}>\n        <Typography variant=\"subtitle2\">\n          <Box color=\"#FF0000\" fontWeight=\"fontWeightBold\">\n            Vaccination pending\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n            <Box fontWeight=\"fontWeightBold\" my={2}>\n              No vaccination registration found for {registeredPhone}\n              {autoCallBackState.isTimerOn &&\n                <Typography>\n                   Taking you back in {autoCallBackState.callBackDelayInSeconds}\n                </Typography>\n              }\n            </Box>\n        </Typography>\n      </Grid>\n      {alternateNumberElement}\n    </Grid>\n  )\n};\n\nexport const renderAlternatePhoneInitState = (classes, state, submitRegisteredPhone, changeRegisteredPhone, confirmRegisteredPhone) => {\n  return (\n    <Grid alignItems=\"center\" justify=\"center\" direction=\"column\">\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n            <Box fontWeight=\"fontWeightBold\" my={2}>\n              Enter phone number used for Vaccination\n            </Box>\n        </Typography>\n      </Grid>\n      <Grid item lg={12}>\n        <TextField\n          maxLength={10}\n          fullWidth={true}\n          size=\"small\"\n          type=\"number\"\n          id=\"alternatePhone\"\n          label=\"Vaccination Phone Number\"\n          variant=\"outlined\"\n          value={state.registeredPhone}\n          onChange={e => changeRegisteredPhone(e.target.value)}\n        />\n      </Grid>\n      <Grid item lg={12}>\n        <Button className={classes.button}\n          variant=\"contained\"\n          color=\"primary\"\n          fullWidth={true}\n          id=\"confirmRegisteredPhone\"\n          onClick={confirmRegisteredPhone}>\n          <Typography variant=\"subtitle1\">\n              Send OTP\n          </Typography>\n        </Button>\n      </Grid>\n    </Grid>\n  )\n};\n\nexport const renderPhoneNumberConfirmation = (classes, state, submitRegisteredPhone, enterAlternatePhoneInitStage) => {\n  return (\n    <Grid container alignItems=\"center\" justify=\"center\" direction=\"column\">\n      <Grid item lg={12} justify=\"center\">\n        <SvgIcon component={QuestionIcon} overflow=\"visible\" />\n      </Grid>\n      <Grid item lg={12}>\n        <Typography variant=\"h6\">\n          <Box fontWeight=\"fontWeightBold\" my={2}>\n            Are you sure you used {state.registeredPhone} for Vaccination?\n          </Box>\n        </Typography>\n      </Grid>\n      <Grid container direction=\"row\" justify=\"space-between\" spacing={1}>\n        <Grid item xs={6}>\n          <Button className={classes.button}\n            variant=\"outlined\"\n            color=\"primary\"\n            fullWidth={true}\n            id=\"submitRegisteredPhone\"\n            onClick={submitRegisteredPhone}>\n            <Typography variant=\"subtitle2\">\n              Yes\n            </Typography>\n          </Button>\n        </Grid>\n        <Grid item xs={6}>\n          <Button className={classes.button}\n            variant=\"outlined\"\n            color=\"primary\"\n            fullWidth={true}\n            id=\"declineRegisteredPhone\"\n            onClick={enterAlternatePhoneInitStage}>\n            <Typography variant=\"subtitle2\">\n              No\n            </Typography>\n          </Button>\n        </Grid>\n      </Grid>\n    </Grid>\n  )\n};","import React, { useState, useEffect } from 'react';\nimport { withRouter } from \"react-router\";\nimport * as _ from 'lodash';\nimport { SECRET_KEYS, PROCESS_STAGE, API_URLS, ERROR_CODE, COWIN_ERROR_CODE,\n  OTP_RETRY_TIME, MAX_BOOKING_ATTEMPT, INVALID_PHONE_REASONS_TEXT, DEFAULT_AUTO_CALLBACK_STATE } from './constants';\nimport Card from '@material-ui/core/Card';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { makePostCall } from './utils/network';\nimport { fetchBenficiaries } from './booking/beneficiary';\nimport { fetchSlots } from './booking/slot';\nimport { getSearchParamsFromUrl } from './utils/queryParams';\nimport { triggerCallback } from './webCallback';\nimport Image from './assests/build4bharat.jpg';\nimport Box from '@material-ui/core/Box';\nimport { renderOtpStage, renderCaptchStage, renderSuccessStage, renderExistingBookingStage,\n  renderBookingFailedStage, renderVaccinatedStage, renderErrorStage, renderRegisteredStage,\n  renderNotRegiseteredState, renderAlternatePhoneInitState, renderPhoneNumberConfirmation } from './stateView';\nconst shajs = require('sha.js');\n\nconst useStyles = makeStyles({\n  root: {\n    backgroundColor: '#B2EBFE',\n    width: '100%'\n  },\n  image: {\n    overflowY: 'hidden',\n    width: '100%'\n  },\n  card: {\n    flexGrow: 1,\n    width: '90%',\n    minHeight: '25%',\n    margin: 'auto',\n    padding: '5%',\n    position: 'absolute',\n    bottom: 0\n  },\n  button: {\n    marginTop: 10,\n    borderRadius: 12\n  },\n  goHomeButton: {\n    marginTop: 20\n  },\n  body: {\n    marginTop: '5%',\n  }\n});\n\nfunction getRandomSecretKey() {\n  const index = parseInt((Math.random()*10))%6;\n  return SECRET_KEYS[index];\n}\n\nfunction App(props) {\n  const searchParams = getSearchParamsFromUrl(props.location.search);\n  const initialStage = _.isEmpty(searchParams.phone) ? PROCESS_STAGE.ALTERNATE_PHONE_INIT : PROCESS_STAGE.INIT;\n  const [state, setState] = useState({...searchParams,\n    stage: initialStage, otp: '', registeredPhone: _.get(searchParams, 'phone'),\n    lastPhone: _.get(searchParams, 'phone'), registeredBeneficiaryList: [] });\n  const [retryTime, setRetryTime] = useState(OTP_RETRY_TIME);\n  const [bookingAttempt, setBookingAttempt] = useState(1);\n  const [autoCallBackState, setAutoCallBackState] = useState(DEFAULT_AUTO_CALLBACK_STATE);\n\n  const stateCallback = (updatedState) => {\n    setState({...state, ...updatedState});\n  };\n  const changeOtp = (otp) => {\n    setState({...state, otp});\n  };\n\n  const triggerOtp = async () => {\n    const secretKey = getRandomSecretKey();\n    setRetryTime(OTP_RETRY_TIME);\n    try {\n      const data = await makePostCall(API_URLS.INIT, {\n        \"mobile\": state.registeredPhone,\n        \"secret\": secretKey\n      }, stateCallback);\n      setState({...state, txnId: data.txnId, stage: PROCESS_STAGE.VALIDATE_OTP});\n    } catch(err) {\n      \n    }\n  };\n  const submitOtp = async () => {\n    const otpHash = shajs('sha256').update(state.otp).digest('hex');\n    try {\n      const data = await makePostCall(API_URLS.VALIDATE_OTP, {\n        \"otp\": otpHash,\n        \"txnId\": state.txnId\n      }, stateCallback);\n      setState({...state, token: data.token, errorObj: {}, stage: PROCESS_STAGE.FETCH_BENEFICIARY });\n    } catch(err) {\n    }\n  };\n\n  const rescheduleSlot = async (appointmentId) => {\n    try {\n      // API returns 204 on success.\n      await makePostCall(API_URLS.RESCHEDULE, {\n        \"appointment_id\": appointmentId,\n        \"session_id\": state.vaccineSlot.session_id,\n        \"slot\": state.vaccineSlot.slot_time\n      }, stateCallback, state.token);\n      setState({...state, errorObj:{}, stage: PROCESS_STAGE.SLOT_BOOKED, appointmentId });\n    } catch (err) {\n      setState({...state, errorObj:{ code: ERROR_CODE.BOOKING_FAILED, message: 'Appointment not confirmed' } });\n    }\n  };\n\n  const scheduleSlot = async () => {\n    const appointmentId = _.get(state, 'appointmentId', '');\n    if(!_.isEmpty(appointmentId)) {\n      await rescheduleSlot(appointmentId);\n      return;\n    }\n\n    try {\n      const data = await makePostCall(API_URLS.SCHEDULE, {\n        \"beneficiaries\": [state.beneficiaryDetails.beneficiary_reference_id],\n        \"center_id\": state.vaccineSlot.center_id,\n        \"slot\": state.vaccineSlot.slot_time,\n        \"session_id\": state.vaccineSlot.session_id,\n        \"dose\": state.doseToBook\n      }, stateCallback, state.token);\n      const appointmentId = _.get(data, 'appointment_confirmation_no');\n      if (!_.isEmpty(appointmentId)) {\n        setState({...state, errorObj:{}, stage: PROCESS_STAGE.SLOT_BOOKED, appointmentId })\n      } else {\n        setState({...state, errorObj:{ code: ERROR_CODE.BOOKING_FAILED, message: 'Appointment not confirmed' } })\n      }\n    } catch(err) {\n    }\n  };\n\n  const changeRegisteredPhone = (registeredPhone) => {\n    setState({ ...state, registeredPhone });\n  };\n\n  const submitRegisteredPhone =  () => {\n    const activePhone = state.registeredPhone;\n    if (_.size(activePhone) !== 10) {\n      setState({ ...state, errorObj: {\n        code: ERROR_CODE.INVALID_PHONE,\n        message: INVALID_PHONE_REASONS_TEXT.DEFAULT\n      }});\n      return;\n    }\n\n    setState({ ...state, stage: PROCESS_STAGE.INIT, lastPhone: state.registeredPhone });\n  };\n\n  const enterAlternatePhoneInitStage = () => {\n    setState({ ...state, \n      stage: PROCESS_STAGE.ALTERNATE_PHONE_INIT,\n      otp: '',\n      errorObj: null,\n      registeredPhone: ''\n    });\n  };\n\n  const confirmRegisteredPhone = () => {\n    setState({ ...state,\n      stage: PROCESS_STAGE.CONFIRM_PHONE\n    });\n  }\n\n  const goToHome = () => {\n    triggerCallback(state, 0);\n  };\n\n  const renderErrorItem = () => {\n    if (_.isEmpty(_.get(state.errorObj, 'message')) || _.get(state, 'stage') === PROCESS_STAGE.NOT_REGISTERED) {\n      return null;\n    }\n    return (\n      <Grid alignItems=\"center\" justify=\"center\">\n        <Grid item lg={12}>\n        <Typography color=\"error\">\n          <Box fontWeight=\"fontWeightBold\">\n            {state.errorObj.message}\n          </Box>\n          </Typography>\n        </Grid>\n      </Grid>\n    )\n  };\n  const getRenderView = (classes) => {\n      switch(state.stage) {\n      case PROCESS_STAGE.SLOT_BOOKED:\n        return renderSuccessStage(classes);\n      case PROCESS_STAGE.VACCINATED:\n        return renderVaccinatedStage(classes);  \n      case PROCESS_STAGE.EXISTING_BOOKING:\n        return renderExistingBookingStage({ classes, enterAlternatePhoneInitStage,\n          goToHome, autoCallBackState });\n      case PROCESS_STAGE.BOOKING_FAILED:\n        return renderBookingFailedStage(state, bookingAttempt, classes);\n      case PROCESS_STAGE.ERROR:\n        return renderErrorStage(state, classes);\n      case PROCESS_STAGE.REGISTERED:\n        return renderRegisteredStage({ classes, registeredPhone: state.registeredPhone,\n          enterAlternatePhoneInitStage, goToHome, autoCallBackState });\n      case PROCESS_STAGE.NOT_REGISTERED:\n        return renderNotRegiseteredState({ classes, registeredPhone: state.registeredPhone, \n          enterAlternatePhoneInitStage, goToHome, autoCallBackState });\n      case PROCESS_STAGE.ALTERNATE_PHONE_INIT:\n        return renderAlternatePhoneInitState(classes, state, submitRegisteredPhone, changeRegisteredPhone, confirmRegisteredPhone);\n      case PROCESS_STAGE.CONFIRM_PHONE:\n        return renderPhoneNumberConfirmation(classes, state, submitRegisteredPhone, enterAlternatePhoneInitStage);\n      default:\n        return renderOtpStage({state, retryTime, classes, changeOtp, submitOtp, triggerOtp, enterAlternatePhoneInitStage});\n    }\n  }\n  const handleBookingFailure = () => {\n    setState({...state, errorObj: {}, stage: PROCESS_STAGE.BOOKING_FAILED});\n    if (bookingAttempt < MAX_BOOKING_ATTEMPT) {\n      const intervalId = setTimeout(() => {\n        setBookingAttempt(bookingAttempt+1);\n      }, 3000);\n      return () => clearInterval(intervalId);\n    } else {\n      triggerCallback({...state, stage: PROCESS_STAGE.BOOKING_FAILED});\n    }\n  };\n  useEffect(() => {\n    switch(state.stage) {\n      case PROCESS_STAGE.INIT:\n        if (state.registeredPhone) {\n          triggerOtp();\n        }\n        break;\n      case PROCESS_STAGE.FETCH_BENEFICIARY:\n        fetchBenficiaries(state, stateCallback);\n        break;\n      case PROCESS_STAGE.FETCH_SLOTS:\n        fetchSlots(state, stateCallback);\n        break;\n      case PROCESS_STAGE.SCHEDULE:\n        scheduleSlot(state, stateCallback);\n        break;\n      case PROCESS_STAGE.SLOT_BOOKED:\n      case PROCESS_STAGE.VACCINATED:\n      case PROCESS_STAGE.ERROR:\n        triggerCallback(state);\n        break;\n      case PROCESS_STAGE.NOT_REGISTERED:\n      case PROCESS_STAGE.REGISTERED:\n      case PROCESS_STAGE.EXISTING_BOOKING:\n        setAutoCallBackState({ ...DEFAULT_AUTO_CALLBACK_STATE, isTimerOn: true });\n        return;\n      default:\n        break;\n    }\n\n    setAutoCallBackState(DEFAULT_AUTO_CALLBACK_STATE);\n  }, [state.stage]);\n  useEffect(() => {\n    const code = _.get(state.errorObj, 'code');\n    if (!code) {\n      return;\n    }\n\n    switch (state.stage) {\n      case PROCESS_STAGE.FETCH_BENEFICIARY:\n        setState({ ...state, stage: PROCESS_STAGE.NOT_REGISTERED });\n        return;\n      default: break;\n    };\n\n    switch(state.errorObj.code) {\n      case ERROR_CODE.INVALID_PHONE:\n        return;\n      case COWIN_ERROR_CODE[ERROR_CODE.INVALID_OTP]:\n        return;\n      case COWIN_ERROR_CODE[ERROR_CODE.EXISTING_BOOKING]:\n        setState({...state, stage: PROCESS_STAGE.EXISTING_BOOKING });\n        return;\n      case COWIN_ERROR_CODE[ERROR_CODE.NO_BENEFICIARY]:\n        setState({ ...state, stage: PROCESS_STAGE.NOT_REGISTERED });\n        return;\n      case ERROR_CODE.NO_SLOT:\n        handleBookingFailure();\n        return;\n      case ERROR_CODE.NO_BENEFICIARY:\n        return;\n      default:\n        if (state.stage === PROCESS_STAGE.SCHEDULE) {\n          handleBookingFailure();\n        } else {\n          setState({...state, stage: PROCESS_STAGE.ERROR });\n        }\n       return;\n    };\n  }, [state.errorObj]);\n  useEffect(() => {\n    if (!retryTime) return;\n    const intervalId = setTimeout(() => {\n      setRetryTime(retryTime-1);\n    }, 1000);\n    return () => clearInterval(intervalId);\n  }, [retryTime])\n  useEffect(() => {\n    if (state.stage === PROCESS_STAGE.BOOKING_FAILED) {\n      setState({...state, errorObj: {}, captcha:'', stage: PROCESS_STAGE.FETCH_SLOTS});\n    }\n  }, [bookingAttempt])\n  useEffect(() => {\n    if (!autoCallBackState.isTimerOn) {\n      return;\n    }\n    if (autoCallBackState.callBackDelayInSeconds <= 0) {\n      triggerCallback(state, 0);\n      return;\n    }\n\n    const intervalId = setTimeout(() => {\n      setAutoCallBackState({\n        ...autoCallBackState,\n        callBackDelayInSeconds: autoCallBackState.callBackDelayInSeconds - 1\n      });\n    }, 1000);\n    return () => clearInterval(intervalId);\n  }, [autoCallBackState])\n\n  const classes = useStyles();\n  const renderView = getRenderView(classes);\n  const errorItem = renderErrorItem(); \n  return (\n    <div className={classes.root}>\n      <img src={`${Image}`} className={classes.image} />\n      <Card className={classes.card}>\n        {errorItem}\n        {state.isLoading && <CircularProgress />}\n        {renderView}\n      </Card>\n    </div>\n  );\n}\n\nexport default withRouter(App);\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { BrowserRouter as Router, Route } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <Route path=\"/\" component={App} />\n    </Router>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}